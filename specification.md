# **XImgDock 仕様書**

## 1. 概要

**XImgDock** は、VS Code 上で XHTML ファイルの編集を支援する拡張機能です。以下の機能を提供します。

1. **ライブプレビュー**: XHTML 編集内容をリアルタイムにプレビュー
2. **画像ドック**: 画像一覧を表示し、ダブルクリックで `<img>` タグを挿入
3. **構文診断**: XHTML のパースエラーを自動検出

---

## 2. 画面構成

XImgDock の利用時、VS Code 内で以下の 4 領域を中心に構成される。

1. **ファイルツリー**

   * プロジェクト内のファイル・フォルダ構造を表示
   * XHTML や画像フォルダを選択して開く

2. **エディタ画面**

   * XHTML ファイルを編集する主要領域
   * 診断エラーが赤波線で表示される

3. **プレビュー（Webview）**

   * 編集中の XHTML をレンダリングして表示
   * エディタと双方向同期（クリック / ダブルクリックによる位置対応）

4. **画像ギャラリー（Webview）**

   * 選択したフォルダの画像を一覧表示
   * サムネイル・ファイル名・サイズを確認可能
   * クリックで挿入、右クリックでプレビューや挿入を選択

---

## 3. UI/UX 要件

### 3.1. プレビュー

#### (1) 基本機能

* **HTML / XHTML / XML ファイルのプレビュー表示**

  * エディタの編集内容を別ペインに即時反映

* **エディタとプレビューの双方向同期**

  * エディタ変更 → プレビュー更新
  * エディタ上でダブルクリック → プレビューを対応位置にスクロール
  * エディタにカーソルを置いたままプレビューをスクロール → エディタ対応行へ移動

#### (2) 行ごとの対応付け

* 各行とプレビュー要素をリンク
* 精密な行間同期を実現

#### (3) 画像表示

* 相対パス画像を Webview に変換して表示

#### (4) ユーザー体験

* 短い遅延を入れて再描画負荷を軽減
* ダブルクリック・スクロールなど直感的操作
* プレビュー行をホバーで行番号表示
* 読み込み中は「読み込み中…」表示

#### (5) リソース管理

* プレビュー終了時にリソースを自動解放

---

### 3.2. 画像ドック

#### (1) 画像フォルダ管理

* 任意フォルダを選択して画像を一覧表示
* サポート形式: PNG / JPG / JPEG / GIF / BMP / WEBP / SVG
* 各画像の情報（名前 / サイズ / 更新日 / パス）を取得

#### (2) サムネイル & リスト表示

* サムネイル生成と一覧表示
* ツリー表示 / グリッド表示切替
* サムネイルサイズを設定から変更可能

#### (3) ソート & 更新

* 並び替え: 「名前順」「サイズ順」「更新日順」
* 手動更新で最新状態を反映

#### (4) エディタ連携

* ダブルクリックやコマンドでカーソル部分に `<img>` タグを挿入
* コンテキストメニューから「画像を挿入」

#### (5) ギャラリー表示 (Webview)

* グリッドレイアウトで画像一覧
* 操作ボタン: フォルダ選択 / 更新 / ソート切替
* 各画像に「サムネイル」「ファイル名」「サイズ」表示
* ダブルクリックで挿入

#### (6) キャッシュ & 設定

* サムネイルキャッシュのクリア & 再生成
* 設定変更（例: サムネイルサイズ）が即時反映

#### (7) リソース管理

* プレビューやギャラリー終了時にリソース解放
* キャッシュ / Webview を適切に破棄

---

### 3.3. 構文診断

* XHTML を `fast-xml-parser` で解析
* エラー時：

  * エディタ上に赤波線を表示 (Diagnostics API)
  * 「問題」パネルに詳細メッセージを出力




ximgdock/
├── .vscodeignore             // パッケージングから除外するファイル
├── dist/                     // TypeScriptからコンパイルされたJSファイル
│   └── extension.js
├── node_modules/             // 依存パッケージ
├── src/                      // ソースコード
│   ├── webview/              // Webview用のアセット
│   │   ├── main.js           // Webview用のスクリプト(同期処理)
│   │   └── preview.html      // Webview用のHTMLテンプレート
│   ├── extension.ts          // 拡張機能のメインファイル
│   └── previewProvider.ts    // ライブプレビューのロジック
├── .eslintrc.js              // ESLintの設定ファイル
├── package.json              // 拡張機能のマニフェストファイル
├── package-lock.json         // 依存パッケージのバージョンロック
├── tsconfig.json             // TypeScriptの設定ファイル
└── webpack.config.js         // webpackの設定ファイル